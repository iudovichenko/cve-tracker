{% extends "base.html" %}
{% block title %}Unresolved CVEs{% endblock %}
{% block content %}
    <a name="top"></a>
    <table>
        <tr>
            <th>Product</th>
            <th>Packages Affected</th>
            <th>CVEs Affected</th>
            <th>CVEs Resolved</th>
        </tr>
    {% for name,stat in data['stat']|dictsort %}
        <tr>
            <td><a href="#{{name}}">{{name}}</a></td>
            <td>{{stat['packages']|count}}</td>
            <td>{{stat['affected']|count}}</td>
            <td>{{stat['resolved']|count}}</td>
        </tr>
    {% endfor %}
    </table>

    {% for name,objs in data['objs']|dictsort %}
    <h2><a name="{{name}}">{{name}}</a></h2>
    <a href="#top">Back to top</a>
    <table>
        <tr>
            <th>Project</th>
            <th>Version</th>
            <th>Product</th>
            <th>Distribution</th>
            <th>CVEs</th>
        </tr>
        {% for _,t in objs|dictsort %}
            {% for x,related_issues in t %}
        <tr>
            <td><a href="{{root}}/source-project/{{x.source_package.project.id}}.html">{{x.name}}</a></td>
            <td><a href="{{root}}/product-package/{{x.id}}.html">{{x.version}}</a></td>
            <td><a href="{{root}}/product/{{x.product.id}}.html">{{x.product}}</a></td>
            <td><a href="{{root}}/distribution/{{x.product_distribution.id}}.html">{{x.product_distribution}}</a></td>
            <td>
                <table class="noborder">
                    <tr>
                        <th>CVE</th>
                        <th>CVSS2</th>
                        <th>CVSS3</th>
                        <th>Affected</th>
                        <th>Resolved</th>
                    </tr>
                {% for _,y in related_issues|dictsort %}
                    {% set is_tracked, issues = y %}
                    {% set direct, issue = issues[0]['direct'], issues[0]['issue'] %}
                <tr>
                    {% set cve = issue.issue %}
                    <td><a href="{{root}}/cve/{{cve.id}}.html">{{cve.name}}</a></td>
                    {% set cvss2 = cve.cvss2 %}
                    <td>{{cvss2.base_score|string if cvss2 else '0.0'}}</td>
                    {% set cvss3 = cve.cvss3 %}
                    <td>{{cvss3.base_score|string if cvss3 else '0.0'}}</td>
                    {% if is_tracked %}
                    <td bgcolor="{{'red' if issue.affected else 'green'}}">{{issue.affected}}</td>
                    <td bgcolor="{{'green' if issue.resolved else 'red'}}">{{issue.resolved}}</td>
                    {% else %}
                    {% if direct %}
                    <td bgcolor="{{'red' if issue.affected else 'green'}}">{{issue.affected}}</td>
                    <td bgcolor="red">No</td>
                    {% else %}
                    <td bgcolor="red">True</td>
                    <td bgcolor="red">No</td>
                    {% endif %}
                    {% endif %}
                </tr>
                {% endfor %}
                </table>
            </td>
        </tr>
            {% endfor %}
        {% endfor %}
    </table>
    {% endfor %}
{% endblock %}